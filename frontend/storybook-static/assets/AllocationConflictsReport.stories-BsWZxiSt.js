import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{r as s}from"./index-DQLiH3RP.js";import{r as h}from"./reportService-BqbW525N.js";import{C as v}from"./ConflictsChart-Bdp6vxfc.js";import"./apiClient-CuU1bmnr.js";import"./BarChart-o9b-OQvE.js";import"./tiny-invariant-CopsF_GD.js";const d=()=>{const[i,j]=s.useState([]),[c,x]=s.useState(!0),[p,m]=s.useState(null),[r,N]=s.useState(""),[o,b]=s.useState("");return s.useEffect(()=>{(async()=>{try{x(!0);const t=await h.getAllocationConflictsReport();j(t),m(null)}catch{m("Failed to load report")}finally{x(!1)}})()},[]),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Allocation Conflicts Report"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Weekly over-allocation by resource"})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Conflicts Overview"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:r,onChange:t=>N(t.target.value),"data-testid":"conflicts-from",className:"border border-gray-300 rounded-md px-2 py-1 text-sm"}),e.jsx("span",{className:"text-sm text-gray-500",children:"to"}),e.jsx("input",{type:"date",value:o,onChange:t=>b(t.target.value),"data-testid":"conflicts-to",className:"border border-gray-300 rounded-md px-2 py-1 text-sm"})]}),e.jsx("button",{title:c?"Please wait until data finishes loading":i.length===0?"No data to export":void 0,disabled:c||i.length===0,onClick:async()=>{const t={};r&&(t.from=r),o&&(t.to=o);const a=await h.exportReport("ALLOCATION_CONFLICTS",t),g=URL.createObjectURL(a),l=document.createElement("a");l.href=g;const w=r||o?`_${r||"start"}_${o||"end"}`:"";l.download=`allocation-conflicts${w}.xlsx`,document.body.appendChild(l),l.click(),l.remove(),URL.revokeObjectURL(g)},"data-testid":"conflicts-report-export",className:"inline-flex items-center px-3 py-1.5 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Export to Excel"})]})}),e.jsx("div",{className:"px-6 py-4",children:e.jsx(v,{conflicts:i,loading:c,error:p})})]}),!c&&!p&&e.jsxs("div",{className:"mt-8 bg-white shadow rounded-lg overflow-x-auto",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Conflict Details"})}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Resource"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Week"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Max"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Over"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.flatMap(t=>t.weeklyConflicts.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.resourceName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(a.weekStarting).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(a.totalAllocation||0).toFixed(1)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(a.standardLoad||0).toFixed(1)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(a.overAllocation||0).toFixed(1)})]},`${t.resourceId}-${a.weekStarting}`)))})]})]})]})};d.__docgenInfo={description:"",methods:[],displayName:"AllocationConflictsReportPage"};const O={title:"Reports/AllocationConflictsReportPage",component:d},n={render:()=>e.jsx(d,{})};var f,y,u;n.parameters={...n.parameters,docs:{...(f=n.parameters)==null?void 0:f.docs,source:{originalSource:`{
  render: () => <AllocationConflictsReportPage />
}`,...(u=(y=n.parameters)==null?void 0:y.docs)==null?void 0:u.source}}};const _=["Default"];export{n as Default,_ as __namedExportsOrder,O as default};
